<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Installation Guide - Crunchy Containers for PostgreSQL</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8"></meta><meta property="og:site_name" content="Crunchy Containers"></meta><meta property="og:title" content="Installation Guide - Crunchy Containers for PostgreSQL"></meta><meta property="og:type" content="website"></meta><meta property="og:image:type" content="image/png"></meta><meta property="og:image" content="{[backrest-url-base]}/logo.svg"></meta><meta name="description" content="Installation Guide - Crunchy Containers for PostgreSQL"></meta><meta property="og:description" content="Installation Guide - Crunchy Containers for PostgreSQL"></meta><link rel="stylesheet" href="default.css" type="text/css"></link></head><body><div id="header-wrapper"><div class="page-header" id="page-header"><div class="page-header-logo"><img src="logo.svg"></div><div class="page-header-title">Installation Guide - Crunchy Containers for PostgreSQL</div></div><div class="page-menu"><div class="menu-body"><div class="menu"><a class="menu-link" href="install.html">Home</a></div><div class="menu"><a class="menu-link" href="containers.html">Containers</a></div><div class="menu"><a class="menu-link" href="examples.html">Examples</a></div><div class="menu"><a class="menu-link" href="pitr.html">PITR</a></div><div class="menu"><a class="menu-link" href="dedicated.html">Dedicated</a></div><div class="menu"><a class="menu-link" href="backrest.html">Backup</a></div></div></div></div><div id="content-wrapper"><div id="sidebar-wrapper"><div id="sidebar"><div class="page-toc"><div class="page-toc-header"><div class="page-toc-title"></div></div><div class="page-toc-body"><div class="section1-toc"><div class="section1-toc-number">1</div><div class="section1-toc-title"><a href="#_project_setup">Project Setup</a></div><div class="section2-toc"><div class="section2-toc-number">1.1</div><div class="section2-toc-title"><a href="#_project_setup/_project_directory_structure">Project Directory Structure</a></div></div><div class="section2-toc"><div class="section2-toc-number">1.2</div><div class="section2-toc-title"><a href="#_project_setup/_creating_a_demo_namespace_on_kubernetes">Creating a Demo Namespace on Kubernetes</a></div></div><div class="section2-toc"><div class="section2-toc-number">1.3</div><div class="section2-toc-title"><a href="#_project_setup/_creating_a_demo_namespace_on_openshift">Creating a Demo Namespace on OpenShift</a></div></div><div class="section2-toc"><div class="section2-toc-number">1.4</div><div class="section2-toc-title"><a href="#_project_setup/_installing_postgresql">Installing PostgreSQL</a></div></div></div><div class="section1-toc"><div class="section1-toc-number">2</div><div class="section1-toc-title"><a href="#_docker_environment">Docker Environment</a></div><div class="section2-toc"><div class="section2-toc-number">2.1</div><div class="section2-toc-title"><a href="#_docker_environment/_build_the_containers">Build the Containers</a></div></div></div><div class="section1-toc"><div class="section1-toc-number">3</div><div class="section1-toc-title"><a href="#_configure_container_storage">Configure Container Storage</a></div><div class="section2-toc"><div class="section2-toc-number">3.1</div><div class="section2-toc-title"><a href="#_configure_container_storage/_configure_hostpath">Configure HostPath</a></div></div><div class="section2-toc"><div class="section2-toc-number">3.2</div><div class="section2-toc-title"><a href="#_configure_container_storage/_configure_nfs_for_persistence">Configure NFS for Persistence</a></div></div><div class="section2-toc"><div class="section2-toc-number">3.3</div><div class="section2-toc-title"><a href="#_configure_container_storage/_configure_gluster_for_persistence">Configure Gluster for Persistence</a></div></div></div><div class="section1-toc"><div class="section1-toc-number">4</div><div class="section1-toc-title"><a href="#_openshift_environment">OpenShift Environment</a></div></div><div class="section1-toc"><div class="section1-toc-number">5</div><div class="section1-toc-title"><a href="#_kubernetes_environment">Kubernetes Environment</a></div><div class="section2-toc"><div class="section2-toc-number">5.1</div><div class="section2-toc-title"><a href="#_kubernetes_environment/_helm_optional">Helm (optional)</a></div></div><div class="section2-toc"><div class="section2-toc-number">5.2</div><div class="section2-toc-title"><a href="#_kubernetes_environment/_dns">DNS</a></div></div><div class="section2-toc"><div class="section2-toc-number">5.3</div><div class="section2-toc-title"><a href="#_kubernetes_environment/_google_cloud_environment">Google Cloud Environment</a></div></div><div class="section2-toc"><div class="section2-toc-number">5.4</div><div class="section2-toc-title"><a href="#_kubernetes_environment/_tips">Tips</a></div></div></div><div class="section1-toc"><div class="section1-toc-number">6</div><div class="section1-toc-title"><a href="#_legal_notices">Legal Notices</a></div></div></div></div></div></div><div id="page-wrapper"><div id="page-body"><div class="section1"><a id="_project_setup"></a><div class="section1-header"><div class="section1-number">1</div><div class="section1-title">Project Setup</div></div><div class="section-body"><div class="section-body-text">The crunchy-containers can run on different environments including:</div><ul class="list-unordered"><li class="list-unordered"><b>Docker 1.12</b></li><li class="list-unordered"><b>OpenShift Container Platform 3.6</b></li><li class="list-unordered"><b>Kubernetes 1.8+</b></li></ul><div class="section-body-text">In this document we list the basic installation steps required for these environments.</div><div class="section-body-text">These installation instructions are developed and tested for the following operating systems:</div><ul class="list-unordered"><li class="list-unordered"><b>CentOS 7</b></li><li class="list-unordered"><b>RHEL 7</b></li></ul><div class="section2"><a id="_project_setup/_project_directory_structure"></a><div class="section2-header"><div class="section2-number">1.1</div><div class="section2-title">Project Directory Structure</div></div><div class="section-body"><div class="section-body-text">First add the following lines to your .bashrc file to set the project paths:</div><pre class="code-block">export GOPATH=$HOME/cdev
export GOBIN=$GOPATH/bin
export PATH=$PATH:$GOBIN
export CCP_BASEOS=centos7
export CCP_PGVERSION=10
export CCP_PG_FULLVERSION=10.3
export CCP_VERSION=1.8.1
export CCP_IMAGE_PREFIX=crunchydata
export CCP_IMAGE_TAG=$CCP_BASEOS-$CCP_PG_FULLVERSION-$CCP_VERSION
export CCPROOT=$GOPATH/src/github.com/crunchydata/crunchy-containers
export CCP_CLI=kubectl
export CCP_NAMESPACE=demo
export PV_PATH=/mnt/nfsfileshare
export LOCAL_IP=$(hostname --ip-address)
export REPLACE_CCP_IMAGE_PREFIX=crunchydata</pre><div class="section-body-text">It will be necessary to refresh your bashrc file in order for the changes to take effect.</div><pre class="code-block">. ~/.bashrc</pre><div class="section-body-text">Next, set up a project directory structure and pull down the project:</div><pre class="code-block">mkdir $HOME/cdev $HOME/cdev/src $HOME/cdev/pkg $HOME/cdev/bin</pre><div class="section-body-text">At this point, if you are installing crunchy-containers on a CentOS 7 machine, you may continue with the following instructions. If you are doing an installation on RHEL 7, please view the instructions located <a href="https://github.com/crunchydata/crunchy-containers/blob/master/docs/install.adoc#rhel-7">below</a> that are specific to RHEL environments.</div><div class="section3"><a id="_project_setup/_project_directory_structure/_centos_7"></a><div class="section3-header"><div class="section3-number">1.1.1</div><div class="section3-title">CentOS 7</div></div><div class="section-body"><pre class="code-block">cd $GOPATH
sudo yum -y install golang git docker
go get github.com/tools/godep
cd src/github.com
mkdir crunchydata
cd crunchydata
git clone https://github.com/crunchydata/crunchy-containers
cd crunchy-containers
git checkout 1.8.1
go get github.com/blang/expenv</pre><div class="section-body-text"><b>If you are a Crunchy enterprise customer, you will place the Crunchy repository key and yum repository file into the $CCPROOT/conf directory at this point. These files can be obtained through <a href="https://access.crunchydata.com/">https://access.crunchydata.com/</a> on the downloads page.</b></div></div></div><div class="section3"><a id="_project_setup/_project_directory_structure/_rhel_7"></a><div class="section3-header"><div class="section3-number">1.1.2</div><div class="section3-title">RHEL 7</div></div><div class="section-body"><div class="section-body-text">When setting up the environment on RHEL 7, there are slightly different steps that need to be taken.</div><pre class="code-block">cd $GOPATH
sudo subscription-manager repos --enable=rhel-7-server-optional-rpms
sudo yum-config-manager --enable rhel-7-server-extras-rpms
sudo yum -y install git golang
go get github.com/tools/godep
cd src/github.com
mkdir crunchydata
cd crunchydata
git clone https://github.com/crunchydata/crunchy-containers
cd crunchy-containers
git checkout 1.8.1
go get github.com/blang/expenv</pre><div class="section-body-text"><b>If you are a Crunchy enterprise customer, you will place the Crunchy repository key and yum repository file into the $CCPROOT/conf directory at this point. These files can be obtained through <a href="https://access.crunchydata.com/">https://access.crunchydata.com/</a> on the downloads page.</b></div></div></div></div></div><div class="section2"><a id="_project_setup/_creating_a_demo_namespace_on_kubernetes"></a><div class="section2-header"><div class="section2-number">1.2</div><div class="section2-title">Creating a Demo Namespace on Kubernetes</div></div><div class="section-body"><div class="section-body-text">This section will illustrate how to set up a new Kubernetes namespace called <b>demo</b>, and will then show how to provide permissions to that namespace to allow the Kubernetes examples to run within that namespace. This is a <b>requirement</b> for running the examples.</div><div class="section-body-text">First, view currently existing namespaces:</div><pre class="code-block">$ kubectl get namespace
NAME          STATUS    AGE
default       Active    21d
kube-public   Active    21d
kube-system   Active    21d</pre><div class="section-body-text">Then, create a new namespace called <b>demo</b>:</div><pre class="code-block">$ kubectl create -f $CCPROOT/conf/demo-namespace.json
namespace "demo" created
$ kubectl get namespace demo
NAME      STATUS    AGE
demo      Active    7s</pre><div class="section-body-text">Then we'll set the namespace as our current location:</div><pre class="code-block">$ kubectl config set-context $(kubectl config current-context) --namespace=demo</pre><div class="section-body-text">We can verify that the namespace was set correctly through the following command:</div><pre class="code-block">$ kubectl config view | grep namespace:
    namespace: demo</pre></div></div><div class="section2"><a id="_project_setup/_creating_a_demo_namespace_on_openshift"></a><div class="section2-header"><div class="section2-number">1.3</div><div class="section2-title">Creating a Demo Namespace on OpenShift</div></div><div class="section-body"><div class="section-body-text">This section will illustrate how to set up a new OpenShift project called <b>demo</b>. This is a <b>requirement</b> for running the examples.</div><div class="section-body-text">First we will create a new project:</div><pre class="code-block">$ oc new-project demo --description="Crunchy Containers project" --display-name="Crunchy-Containers"
Now using project "demo" on server "https://127.0.0.1:8443".

You can add applications to this project with the 'new-app' command. For example, try:

    oc new-app centos/ruby-22-centos7~https://github.com/openshift/ruby-ex.git

to build a new example application in Ruby.</pre><div class="section-body-text">If we view the list of projects, we can see the new project has been added and is <q>active</q>.</div><pre class="code-block">$ oc get projects
NAME        DISPLAY NAME         STATUS
demo        Crunchy-Containers   Active
myproject   My Project           Active</pre><div class="section-body-text">If you were on a different project and wanted to switch to the demo project, you would do so by running the following:</div><pre class="code-block">$ oc project demo
Now using project "demo" on server "https://127.0.0.1:8443".</pre></div></div><div class="section2"><a id="_project_setup/_installing_postgresql"></a><div class="section2-header"><div class="section2-number">1.4</div><div class="section2-title">Installing PostgreSQL</div></div><div class="section-body"><div class="section-body-text">These installation instructions assume the installation of PostgreSQL 10 through the official PGDG repository. View the documentation located <a href="https://wiki.postgresql.org/wiki/YUM_Installation">here</a> in order to view more detailed notes or install a different version of PostgreSQL.</div><div class="section-body-text">Locate and edit your distributions .repo file, located:</div><ul class="list-unordered"><li class="list-unordered">On CentOS: /etc/yum.repos.d/CentOS-Base.repo, [base] and [updates] sections</li><li class="list-unordered">On Red Hat: /etc/yum/pluginconf.d/rhnplugin.conf [main] section</li></ul><div class="section-body-text">To the section(s) identified above, you need to append a line (otherwise dependencies might resolve to the PostgreSQL supplied by the base repository):</div><pre class="code-block">exclude=postgresql*</pre><div class="section-body-text">Next, install the RPM relating to the base operating system and PostgreSQL version you wish to install. The RPMs can be found <a href="https://yum.postgresql.org/repopackages.php">here</a>.</div><div class="section-body-text">For example, to install PostgreSQL 10 on a CentOS 7 system:</div><pre class="code-block">sudo yum -y install https://download.postgresql.org/pub/repos/yum/10/redhat/rhel-7-x86_64/pgdg-centos10-10-2.noarch.rpm</pre><div class="section-body-text">Or to install PostgreSQL 10 on a RHEL 7 system:</div><pre class="code-block">sudo yum -y install https://download.postgresql.org/pub/repos/yum/testing/10/redhat/rhel-7-x86_64/pgdg-redhat10-10-2.noarch.rpm</pre><div class="section-body-text">You'll need to update your system:</div><pre class="code-block">sudo yum -y update</pre><div class="section-body-text">Then, go ahead and install the PostgreSQL server package.</div><pre class="code-block">sudo yum -y install postgresql10-server.x86_64</pre></div></div></div></div><div class="section1"><a id="_docker_environment"></a><div class="section1-header"><div class="section1-number">2</div><div class="section1-title">Docker Environment</div></div><div class="section-body"><div class="section-body-text">As good practice, at this point you'll update your system.</div><pre class="code-block">sudo yum -y update</pre><div class="section-body-text">Now we'll install Docker.</div><pre class="code-block">sudo yum -y install docker</pre><div class="section-body-text">After that, it's necessary to add the <b>docker</b> group and give your user access to that group (here referenced as <b>someuser</b>):</div><pre class="code-block">sudo groupadd docker
sudo usermod -a -G docker someuser</pre><div class="section-body-text">Remember to log out of the <b>someuser</b> account for the Docker group to be added to your current session. Once it's added, you'll be able to run Docker commands from your user account.</div><pre class="code-block">su - someuser</pre><div class="section-body-text">You can ensure your <b>someuser</b> account is added correctly by running the following command and ensuring <b>docker</b> appears as one of the results:</div><pre class="code-block">groups</pre><div class="section-body-text">Before you start Docker, you might consider configuring Docker storage: This is described if you run:</div><pre class="code-block">man docker-storage-setup</pre><div class="section-body-text">Follow the instructions available <a href="https://docs.openshift.com/container-platform/3.4/install_config/install/host_preparation.html#configuring-docker-storage">on the main OpenShift documentation page</a> to configure Docker storage appropriately.</div><div class="section-body-text">These steps are illustrative of a typical process for setting up Docker storage. You will need to run these commands as root.</div><div class="section-body-text">First, add an extra virtual hard disk to your virtual machine (see <a href="http://catlingmindswipe.blogspot.com/2012/02/how-to-create-new-virtual-disks-in.html">this blog post</a> for tips on how to do so).</div><div class="section-body-text">Run this command to format the drive, where /dev/sd? is the new hard drive that was added:</div><pre class="code-block">fdisk /dev/sd?</pre><div class="section-body-text">Next, create a volume group on the new drive partition within the fdisk utility:</div><pre class="code-block">vgcreate docker-vg /dev/sd?</pre><div class="section-body-text">Then, you'll need to edit the docker-storage-setup configuration file in order to override default options. Add these two lines to <b>/etc/sysconfig/docker-storage-setup</b>:</div><pre class="code-block">DEVS=/dev/sd?
VG=docker-vg</pre><div class="section-body-text">Finally, run the command <b>docker-storage-setup</b> to use that new volume group. The results should state that the physical volume /dev/sd? and the volume group docker-vg have both been successfully created.</div><div class="section-body-text">Next, we enable and start up Docker:</div><pre class="code-block">sudo systemctl enable docker.service
sudo systemctl start docker.service</pre><div class="section-body-text">Verify that Docker version 1.12.6 was installed, as per the OpenShift 3.6 <a href="https://docs.openshift.com/container-platform/3.6/install_config/install/host_preparation.html#installing-docker">requirements.</a></div><pre class="code-block">docker version</pre><div class="section2"><a id="_docker_environment/_build_the_containers"></a><div class="section2-header"><div class="section2-number">2.1</div><div class="section2-title">Build the Containers</div></div><div class="section-body"><div class="section-body-text">At this point, you have a decision to make - either download prebuilt containers from <a href="https://hub.docker.com/">Dockerhub</a>, <b>or</b> build the containers on your local host.</div><div class="section-body-text">To download the prebuilt containers, make sure you can login to <a href="https://hub.docker.com/">Dockerhub</a>, and then run the following:</div><pre class="code-block">docker login
cd $CCPROOT
./bin/pull-from-dockerhub.sh</pre><div class="section-body-text">Or if you'd rather build the containers from source, perform a container build as follows:</div><pre class="code-block">godep restore
cd $CCPROOT
make setup
make all</pre><div class="section-body-text">After this, you will have all the Crunchy containers built and are ready for use in a <b>standalone Docker</b> environment.</div></div></div></div></div><div class="section1"><a id="_configure_container_storage"></a><div class="section1-header"><div class="section1-number">3</div><div class="section1-title">Configure Container Storage</div></div><div class="section-body"><div class="section-body-text">The Container Suite is tested on 3 different storage backends:</div><ul class="list-unordered"><li class="list-unordered">hostPath (single node testing)</li><li class="list-unordered">NFS (single and multi-node testing)</li><li class="list-unordered">Gluster (dynamic storage on separate Gluster cluster)</li></ul><div class="section-body-text">Other storage backends work as well including GCE, EBS, ScaleIO, and others but may require you to modify various examples or configuration.</div><div class="section2"><a id="_configure_container_storage/_configure_hostpath"></a><div class="section2-header"><div class="section2-number">3.1</div><div class="section2-title">Configure HostPath</div></div><div class="section-body"><div class="section-body-text">HostPath is the simplist storage backend to setup, it only is feasible on a single node but is good for testing the examples. You set up <b>hostPath</b> storage as follows:</div><pre class="code-block">sudo mkdir /data
sudo chmod 777 /data
cd $CCPROOT/examples/pv
./create-pv.sh hostpath
./create-pvc.sh</pre><div class="section-body-text">This set of scripts will create 15 sample Persistent Volumes that all point to <b>/data</b>. It also creates sample Persistent Volume Claims that can be shared by various examples because these Volumes are created as ReadWriteMany.</div></div></div><div class="section2"><a id="_configure_container_storage/_configure_nfs_for_persistence"></a><div class="section2-header"><div class="section2-number">3.2</div><div class="section2-title">Configure NFS for Persistence</div></div><div class="section-body"><div class="section-body-text">NFS is required for some of the examples, including the backup and restore containers.</div><div class="section-body-text">First, if you are running your NFS system with SELinux in enforcing mode, you will need to run the following command to allow NFS write permissions:</div><pre class="code-block">sudo setsebool -P virt_use_nfs 1</pre><div class="section-body-text">Detailed instructions that you can use for setting up a NFS server on Centos 7 are provided in the following link.</div><div class="section-body-text"><a href="http://www.itzgeek.com/how-tos/linux/centos-how-tos/how-to-setup-nfs-server-on-centos-7-rhel-7-fedora-22.html">http://www.itzgeek.com/how-tos/linux/centos-how-tos/how-to-setup-nfs-server-on-centos-7-rhel-7-fedora-22.html</a></div><div class="admonition"><div class="note">NOTE:</div><div class="note-text">Most of the Crunchy containers run as the postgres UID (26), but you will notice that when <b>supplementalGroups</b> are specified, the pod will include the nfsnobody group in the list of groups for the pod user.</div></div><div class="section-body-text">if you are running your client on a VM, you will need to add <i>insecure</i> to the exportfs file on the NFS server due to the way port translation is done between the VM host and the VM instance.</div><div class="section-body-text">For more details on this bug, please see the following link.</div><div class="section-body-text"><a href="http://serverfault.com/questions/107546/mount-nfs-access-denied-by-server-while-mounting">http://serverfault.com/questions/107546/mount-nfs-access-denied-by-server-while-mounting</a></div><div class="section-body-text">A suggested best practice for tuning NFS for PostgreSQL is to configure the PostgreSQL fstab mount options like so:</div><pre class="code-block">proto=tcp,suid,rw,vers=3,proto=tcp,timeo=600,retrans=2,hard,fg,rsize=8192,wsize=8192</pre><div class="section-body-text">Network options:</div><pre class="code-block">MTU=9000</pre><div class="section-body-text">If interested in mounting the same NFS share multiple times on the same mount point, look into the <a href="https://www.novell.com/support/kb/doc.php?id=7010210">noac mount option</a>.</div><div class="section-body-text">Next, assuming that you are setting up NFS as your storage option, you will need to run the following script:</div><pre class="code-block">cd $CCPROOT/examples/pv
./create-pv.sh nfs
./create-pvc.sh</pre><div class="admonition"><div class="note">NOTE:</div><div class="note-text">If you elect to configure HostPath or GCE as your storage option, please view README.txt for command-line usage for the ./create-pv.sh command.</div></div></div></div><div class="section2"><a id="_configure_container_storage/_configure_gluster_for_persistence"></a><div class="section2-header"><div class="section2-number">3.3</div><div class="section2-title">Configure Gluster for Persistence</div></div><div class="section-body"><div class="section-body-text">Setting up a Gluster cluster will offer you the ability to use dynamic storage provisioning in the examples. A set of example Gluster configuration files is found at $CCPROOT/docs/gluster.</div><div class="section-body-text">This configuration is for a 3 node Gluster cluster which runs on a Centos7 Minimal VM deployment. See <a href="https://github.com/CrunchyData/crunchy-containers/blob/master/docs/gluster/gluster-setup.adoc">https://github.com/CrunchyData/crunchy-containers/blob/master/docs/gluster/gluster-setup.adoc</a></div></div></div></div></div><div class="section1"><a id="_openshift_environment"></a><div class="section1-header"><div class="section1-number">4</div><div class="section1-title">OpenShift Environment</div></div><div class="section-body"><div class="section-body-text">See the OpenShift installation guide for details on how to install OpenShift Enterprise on your host. The main instructions are here:</div><div class="section-body-text"><a href="https://docs.openshift.com/container-platform/3.6/install_config/install/quick_install.html">https://docs.openshift.com/container-platform/3.6/install_config/install/quick_install.html</a></div><div class="admonition"><div class="note">NOTE:</div><div class="note-text">If you install OpenShift Enterprise on a server with less than <span class="id">16GB</span> memory and <span class="id">40GB</span> of disk, the following Ansible variables need to be added to <span class="id">~/.config/openshift/installer.cfg.yml</span> prior to installation:</div></div><pre class="code-block">openshift_check_min_host_disk_gb: '10' # min 10gb disk
openshift_check_min_host_memory_gb: '3' # min 3gb memory</pre></div></div><div class="section1"><a id="_kubernetes_environment"></a><div class="section1-header"><div class="section1-number">5</div><div class="section1-title">Kubernetes Environment</div></div><div class="section-body"><div class="section-body-text">See <a href="https://kubernetes.io/docs/setup/independent/install-kubeadm/">kubeadm</a> for installing the latest version of Kubernetes.</div><div class="section2"><a id="_kubernetes_environment/_helm_optional"></a><div class="section2-header"><div class="section2-number">5.1</div><div class="section2-title">Helm (optional)</div></div><div class="section-body"><div class="section-body-text">Some Kubernetes Helm examples are provided in the following directory as one option for deploying the Container Suite.</div><pre class="code-block">$CCPROOT/examples/helm/</pre><div class="section-body-text">Once you have your Kubernetes environment configured, it is simple to get Helm up and running. Please refer to <a href="https://github.com/kubernetes/helm/blob/master/docs/install.md">this document</a> to get Helm installed and configured properly.</div></div></div><div class="section2"><a id="_kubernetes_environment/_dns"></a><div class="section2-header"><div class="section2-number">5.2</div><div class="section2-title">DNS</div></div><div class="section-body"><div class="section-body-text">Please see <a href="https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/">here</a> to view the official documentation regarding configuring DNS for your Kubernetes cluster.</div></div></div><div class="section2"><a id="_kubernetes_environment/_google_cloud_environment"></a><div class="section2-header"><div class="section2-number">5.3</div><div class="section2-title">Google Cloud Environment</div></div><div class="section-body"><div class="section-body-text">The PostgreSQL Container Suite was tested on Google Container Engine.</div><div class="section-body-text">Here is a link to set up a Kube cluster on GCE: <a href="https://kubernetes.io/docs/getting-started-guides/gce">https://kubernetes.io/docs/getting-started-guides/gce</a></div><div class="section-body-text">Setup the persistent disks using GCE disks by first editing your <b>bashrc</b> file and export the GCE settings to match your GCE environment.</div><pre class="code-block">export GCE_DISK_ZONE=us-central1-a
export GCE_DISK_NAME=gce-disk-crunchy
export GCE_DISK_SIZE=4
export GCE_FS_FORMAT=ext4</pre><div class="section-body-text">Then create the PVs used by the examples, passing in the <b>gce</b> value as a parameter. This will cause the GCE disks to be created:</div><pre class="code-block">cd $CCPROOT/examples/pv
./create-pv.sh gce
cd $CCPROOT/examples/pv
./create-pvc.sh</pre><div class="section-body-text">Here is a link that describes more information on GCE persistent disk: <a href="https://cloud.google.com/container-engine/docs/tutorials/persistent-disk/">https://cloud.google.com/container-engine/docs/tutorials/persistent-disk/</a></div><div class="section-body-text">To have the persistent disk examples work, you will need to specify a <b>fsGroup</b> setting in the <b>SecurityContext</b> of each pod script as follows:</div><pre class="code-block">"securityContext": {
 "fsGroup": 26
 },</pre><div class="section-body-text">For our PostgreSQL container, a UID of 26 is specified as the user which corresponds to the <b>fsGroup</b> value.</div></div></div><div class="section2"><a id="_kubernetes_environment/_tips"></a><div class="section2-header"><div class="section2-number">5.4</div><div class="section2-title">Tips</div></div><div class="section-body"><div class="section-body-text">Make sure your hostname resolves to a single IP address in your /etc/hosts file. The NFS examples will not work otherwise and other problems with installation can occur unless you have a resolving hostname.</div><div class="section-body-text">You should see a single IP address returned from this command:</div><pre class="code-block">hostname --ip-address</pre></div></div></div></div><div class="section1"><a id="_legal_notices"></a><div class="section1-header"><div class="section1-number">6</div><div class="section1-title">Legal Notices</div></div><div class="section-body"><div class="section-body-text">Copyright &copy; 2018 Crunchy Data Solutions, Inc.</div><div class="section-body-text">CRUNCHY DATA SOLUTIONS, INC. PROVIDES THIS GUIDE <q>AS IS</q> WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF NON INFRINGEMENT, MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.</div><div class="section-body-text">Crunchy, Crunchy Data Solutions, Inc. and the Crunchy Hippo Logo are trademarks of Crunchy Data Solutions, Inc.</div></div></div><div class="page-footer text-center">Prepared by Crunchy Data Solutions, Inc. &mdash; March 22, 2018</div></div></div></div></body></html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>OpenShift Dedicated Examples - Crunchy Containers for PostgreSQL</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8"></meta><meta property="og:site_name" content="Crunchy Containers"></meta><meta property="og:title" content="OpenShift Dedicated Examples - Crunchy Containers for PostgreSQL"></meta><meta property="og:type" content="website"></meta><meta property="og:image:type" content="image/png"></meta><meta property="og:image" content="{[backrest-url-base]}/logo.svg"></meta><meta name="description" content="OpenShift Dedicated Examples - Crunchy Containers for PostgreSQL"></meta><meta property="og:description" content="OpenShift Dedicated Examples - Crunchy Containers for PostgreSQL"></meta><link rel="stylesheet" href="default.css" type="text/css"></link></head><body><div id="header-wrapper"><div class="page-header" id="page-header"><div class="page-header-logo"><img src="logo.svg"></div><div class="page-header-title">OpenShift Dedicated Examples - Crunchy Containers for PostgreSQL</div></div><div class="page-menu"><div class="menu-body"><div class="menu"><a class="menu-link" href="install.html">Home</a></div><div class="menu"><a class="menu-link" href="containers.html">Containers</a></div><div class="menu"><a class="menu-link" href="examples.html">Examples</a></div><div class="menu"><a class="menu-link" href="pitr.html">PITR</a></div><div class="menu"><a class="menu-link" href="dedicated.html">Dedicated</a></div><div class="menu"><a class="menu-link" href="backrest.html">Backup</a></div></div></div></div><div id="content-wrapper"><div id="sidebar-wrapper"><div id="sidebar"><div class="page-toc"><div class="page-toc-header"><div class="page-toc-title"></div></div><div class="page-toc-body"><div class="section1-toc"><div class="section1-toc-number">1</div><div class="section1-toc-title"><a href="#_openshift_dedicated_environment">OpenShift Dedicated Environment</a></div></div><div class="section1-toc"><div class="section1-toc-number">2</div><div class="section1-toc-title"><a href="#_installation">Installation</a></div><div class="section2-toc"><div class="section2-toc-number">2.1</div><div class="section2-toc-title"><a href="#_installation/_example_details">Example Details</a></div></div><div class="section2-toc"><div class="section2-toc-number">2.2</div><div class="section2-toc-title"><a href="#_installation/_deploying_images_to_openshift_registry">Deploying Images to OpenShift Registry</a></div></div></div><div class="section1-toc"><div class="section1-toc-number">3</div><div class="section1-toc-title"><a href="#_containers_used">Containers Used</a></div><div class="section2-toc"><div class="section2-toc-number">3.1</div><div class="section2-toc-title"><a href="#_containers_used/_crunchy_postgres_container">crunchy-postgres container</a></div></div></div><div class="section1-toc"><div class="section1-toc-number">4</div><div class="section1-toc-title"><a href="#_crunchy_postgres_gis">crunchy-postgres-gis</a></div><div class="section2-toc"><div class="section2-toc-number">4.1</div><div class="section2-toc-title"><a href="#_crunchy_postgres_gis/_crunchy_backup">crunchy-backup</a></div></div><div class="section2-toc"><div class="section2-toc-number">4.2</div><div class="section2-toc-title"><a href="#_crunchy_postgres_gis/_crunchy_pgadmin4">crunchy-pgadmin4</a></div></div></div><div class="section1-toc"><div class="section1-toc-number">5</div><div class="section1-toc-title"><a href="#_openshift_dedicated_template_examples">OpenShift Dedicated Template Examples</a></div><div class="section2-toc"><div class="section2-toc-number">5.1</div><div class="section2-toc-title"><a href="#_openshift_dedicated_template_examples/_primary_database_template">Primary Database Template</a></div></div><div class="section2-toc"><div class="section2-toc-number">5.2</div><div class="section2-toc-title"><a href="#_openshift_dedicated_template_examples/_database_backup_template">Database Backup Template</a></div></div><div class="section2-toc"><div class="section2-toc-number">5.3</div><div class="section2-toc-title"><a href="#_openshift_dedicated_template_examples/_restore_database_template">Restore Database Template</a></div></div><div class="section2-toc"><div class="section2-toc-number">5.4</div><div class="section2-toc-title"><a href="#_openshift_dedicated_template_examples/_replica_database_template">Replica Database Template</a></div></div><div class="section2-toc"><div class="section2-toc-number">5.5</div><div class="section2-toc-title"><a href="#_openshift_dedicated_template_examples/_pgadmin4_web_user_interface_template">pgadmin4 Web User Interface Template</a></div></div></div><div class="section1-toc"><div class="section1-toc-number">6</div><div class="section1-toc-title"><a href="#_legal_notices">Legal Notices</a></div></div></div></div></div></div><div id="page-wrapper"><div id="page-body"><div class="section1"><a id="_openshift_dedicated_environment"></a><div class="section1-header"><div class="section1-number">1</div><div class="section1-title">OpenShift Dedicated Environment</div></div><div class="section-body"><div class="section-body-text">Here are instructions for running examples on an OpenShift 3.5.5 Dedicated environment. For Dedicated, we have built a set of templates that can be installed into a Dedicated instance to help automate the creation of Crunchy Container Suite containers.</div><div class="section-body-text">A defined set of templates are supported for various purposes, including:</div><ul class="list-unordered"><li class="list-unordered">A primary database</li><li class="list-unordered">A replica database</li><li class="list-unordered">A full database backup</li><li class="list-unordered">A full database restore</li><li class="list-unordered">PGAdmin4</li></ul><div class="section-body-text">Each template is described below.</div><div class="section-body-text">There are some limitations presented by OpenShift 3.5.5 in the way in which we can scale up the replica databases. Without support for dynamic volume provisioning and stateful sets, the replica databases can be scaled in a more manual way by creating a new replica database using the provided template. If you want say 3 replica databases, you would use the template 3 times to create the 3 replicas.</div><div class="section-body-text">When OpenShift supports StatefulSets and Dynamic Provisioning, the replica can be included within a Deployment and/or StatefulSet which will allow for scaling to be done by manipulating the Replica Count within the Deployment or StatefulSet.</div></div></div><div class="section1"><a id="_installation"></a><div class="section1-header"><div class="section1-number">2</div><div class="section1-title">Installation</div></div><div class="section-body"><div class="section-body-text">Users can install the templates into their OpenShift environment using the following commands.</div><div class="section-body-text">First, add the following lines to your .bashrc file to set the project paths:</div><pre class="code-block">export GOPATH=$HOME/cdev
export GOBIN=$GOPATH/bin
export PATH=$PATH:$GOBIN
export CCP_BASEOS=centos7
export CCP_PGVERSION=10
export CCP_PG_FULLVERSION=10.3
export CCP_VERSION=1.8.1
export CCP_IMAGE_PREFIX=crunchydata
export CCP_IMAGE_TAG=$CCP_BASEOS-$CCP_PG_FULLVERSION-$CCP_VERSION
export CCPROOT=$GOPATH/src/github.com/crunchydata/crunchy-containers
export CCP_CLI=kubectl
export PV_PATH=/mnt/nfsfileshare
export LOCAL_IP='hostname --ip-address'
export CCP_IMAGE_PREFIX=crunchydata
export REPLACE_CCP_IMAGE_PREFIX=crunchydata
export TOKEN=yourtokengoeshere
export REG=docker-registry-default.router.default.svc.cluster.local
export REG=172.30.240.45:5000
export REG=registry.crunchydata.openshift.com
export CCP_NAMESPACE=demo</pre><div class="section-body-text">You will then need to log out and back in for the changes to your .bashrc file to take effect.</div><div class="section-body-text">Next, set up a project directory structure and pull down the project:</div><pre class="code-block">mkdir $HOME/cdev $HOME/cdev/src $HOME/cdev/pkg $HOME/cdev/bin
cd $GOPATH
sudo yum -y install golang git docker postgresql
go get github.com/tools/godep
cd src/github.com
mkdir crunchydata
cd crunchydata
git clone https://github.com/crunchydata/crunchy-containers
cd crunchy-containers
git checkout 1.8.1
godep restore</pre><div class="section-body-text">Finally, you'll change directories to your Dedicated examples repository and create all the templates stored there.</div><pre class="code-block">cd crunchy-containers/examples/dedicated
./create-all.sh</pre><div class="section2"><a id="_installation/_example_details"></a><div class="section2-header"><div class="section2-number">2.1</div><div class="section2-title">Example Details</div></div><div class="section-body"><div class="section-body-text">Each example will build a template to be later used by users when they want to deploy a Crunchy container.</div><div class="section-body-text">The templates are installed by running the following script within each example directory:</div><pre class="code-block">./run.sh</pre><div class="section-body-text">When you run the examples, there are variable substitutions taking place to set the image path and image tags within the OpenShift templates. This substitution allows for better support of different deployments and deployment environments.</div><div class="section-body-text">You can either use the templates within the OpenShift Web Console using the <b>Add to Project</b> functionality or use the <b>oc</b> CLI locally to use the templates to deploy databases.</div><div class="section-body-text">Within each template directory, there is an <b>example.sh</b> script that shows how to use the template using the <b>oc</b> CLI.</div></div></div><div class="section2"><a id="_installation/_deploying_images_to_openshift_registry"></a><div class="section2-header"><div class="section2-number">2.2</div><div class="section2-title">Deploying Images to OpenShift Registry</div></div><div class="section-body"><div class="section-body-text">You can deploy the Crunchy built container images to the OpenShift registry by running the following script:</div><pre class="code-block">cd $CCPROOT/examples/dedicated
./push-images.sh</pre><div class="section-body-text">The script will create the appropriate image tag and push the image to the remote registry.</div><div class="section-body-text">You can verify the existence of the images on your external Dedicated server through the following commands:</div><pre class="code-block">oc get is
oc get templates</pre><div class="section-body-text"><b>If you are a Crunchy enterprise customer, you will need to change the $TOKEN and $REG values in the push-images.sh script to the ones that correspond to your company's registries along with your personal access token. The necessary token and server information can be obtained either through the web console (console.$YOURCOMPANY.openshift.com) or by visiting your company's API server and requesting a token (<a href="https://api.$YOURCOMPANY.openshift.com/oath/token/request">https://api.$YOURCOMPANY.openshift.com/oath/token/request</a>).</b></div><div class="section-body-text">As you use the templates, you can specify the images in your templates using the OpenShift registry URL as follows for the <b>default</b> OpenShift project:</div><pre class="code-block">172.30.149.135:5000/default</pre></div></div></div></div><div class="section1"><a id="_containers_used"></a><div class="section1-header"><div class="section1-number">3</div><div class="section1-title">Containers Used</div></div><div class="section-body"><div class="section2"><a id="_containers_used/_crunchy_postgres_container"></a><div class="section2-header"><div class="section2-number">3.1</div><div class="section2-title">crunchy-postgres container</div></div><div class="section-body"><div class="section-body-text">The crunchy-postgres container executes the Postgres database.</div><div class="section-body-text"><b>Packages</b></div><div class="section-body-text">The container image is built using either the Crunchy Postgres release or the community version based upon a flag in the Makefile.</div><div class="section-body-text">The Crunchy Postgres RPMs are available to Crunchy customers only. The Crunchy release is meant for customers that require enterprise level support.</div><div class="section-body-text">The PGDG community RPMs can be used as well by simply commenting out the Crunchy yum repo within the Dockerfiles and uncommenting the PGDG yum repo.</div><div class="section-body-text"><b>setup.sql</b></div><div class="section-body-text">The <b>setup.sql</b> script is used to define startup SQL commands that are executed when the database is first created.</div><div class="section-body-text"><b>Environment Variables</b></div><ul class="list-unordered"><li class="list-unordered">PG_MODE - either <b>primary</b>, <b>replica</b> or <b>set</b>, this value determines whether the database is set up as a primary or replica instance. In the case of <b>set</b>, it means the container is started within a StatefulSet in a Kubernetes cluster.</li><li class="list-unordered">PG_PRIMARY_USER - the value to use for the user ID created as primaryuser. The <b>primaryuser</b> has super user privileges.</li><li class="list-unordered">PG_PRIMARY_PASSWORD - the password for the PG_PRIMARY_USER database user</li><li class="list-unordered">PG_USER - the value to use for the user ID created as a normal user. This user is created as part of the setup.sql script upon database creation and allows users to predefine an application user.</li><li class="list-unordered">PG_PASSWORD - the password for the PG_USER database user that is created</li><li class="list-unordered">PG_DATABASE - a database that is created upon database initialization</li><li class="list-unordered">PG_ROOT_PASSWORD - the postgres user password set up upon database initialization</li><li class="list-unordered">PG_LOCALE - if set, the locale you want to create the database with, if not set, the default locale is used</li><li class="list-unordered">SYNC_REPLICA - if set, this value is used to specify the application_name of a replica that will be used for a synchronous replication</li><li class="list-unordered">CHECKSUMS - if set, this value is used to enable the <b>--data-checksums</b> option when initdb is executed at initialization, if not set, the default is to <b>not</b> enable data checksums</li><li class="list-unordered">XLOGDIR - if set, initdb will use the specified directory for WAL</li><li class="list-unordered">ARCHIVE_MODE - if set to <b>on</b>, will enable continuous WAL archiving by setting the value within the postgresql.conf file <b>archive_mode</b> setting, if not set, the default is <b>off</b></li><li class="list-unordered">ARCHIVE_TIMEOUT - if set to a number (in seconds) , will specify the postgresql.conf <b>archive_timeout</b> setting, if not set, the default value of <b>60</b> is used.</li><li class="list-unordered">PGAUDIT_ANALYZE - if set, will cause the container to also start the pgaudit_analyze program in the background</li><li class="list-unordered">PGDATA_PATH_OVERRIDE - if set, will cause the container to use a /pgdata path name of your choosing rather than the hostname of the container which is the default. This is useful for a primary in a deployment.</li></ul><div class="section-body-text"><b>Features</b></div><div class="section-body-text">The following features are supported by the crunchy-postgres container:</div><ul class="list-unordered"><li class="list-unordered">use of OpenShift secrets</li><li class="list-unordered">ability to restore from a database backup</li><li class="list-unordered">use of custom pg_hba.conf and postgresql.conf files</li><li class="list-unordered">ability to override postgresql.conf configuration parameters</li><li class="list-unordered">ability to override the default setup.sql script</li><li class="list-unordered">ability to set the database locale</li><li class="list-unordered">ability to specify a synchronous replica application_name</li><li class="list-unordered">ability to specify a recovery using PITR and WAL files, see pitr.adoc for a detailed design explanation of how PITR is implemented within the container suite</li></ul><div class="section-body-text"><b>Locale Support</b></div><div class="section-body-text">Adding locale support to the container is accomplished by running <i>yum reinstall glibc_common</i> within the container, this increases the size of the container image and can be removed if you do not require specific locale support.</div><div class="section-body-text">You can specify the PG_LOCALE environment variable which is passed to the initdb command when the initial data files are created, for example:</div><pre class="code-block">"name": "PG_LOCALE",
"value": "fr_BE.UTF-8"</pre><div class="section-body-text">By default, no locale is specified when the initdb command is executed.</div></div></div></div></div><div class="section1"><a id="_crunchy_postgres_gis"></a><div class="section1-header"><div class="section1-number">4</div><div class="section1-title">crunchy-postgres-gis</div></div><div class="section-body"><div class="section-body-text">This container is the same as the crunchy-postgres container except that it includes the following PostgreSQL extensions:</div><ul class="list-unordered"><li class="list-unordered">postgis</li><li class="list-unordered">pl/r</li></ul><div class="section-body-text">You can test the pl/r extension by running the following commands for example:</div><pre class="code-block">create extension plr;
SELECT * FROM plr_environ();
SELECT load_r_typenames();
SELECT * FROM r_typenames();
SELECT plr_array_accum('{23,35}', 42);
CREATE OR REPLACE FUNCTION plr_array (text, text)
RETURNS text[]
AS '$libdir/plr','plr_array'
LANGUAGE 'c' WITH (isstrict);
select plr_array('hello','world');</pre><div class="section2"><a id="_crunchy_postgres_gis/_crunchy_backup"></a><div class="section2-header"><div class="section2-number">4.1</div><div class="section2-title">crunchy-backup</div></div><div class="section-body"><div class="section-body-text">The crunchy-backup container executes a pg_basebackup against another database container. The backup is a full backup using the standard utility included with postgres, pg_basebackup.</div><div class="section-body-text"><b>Backup Location</b></div><div class="section-body-text">Backups are stored in a mounted backup volume location, using the database host name plus <b>-backups</b> as a sub-directory, then followed by a unique backup directory based upon a date/timestamp. It is left to the user to perform database backup archives in this current version of the container. This backup location is referenced when performing a database restore.</div><div class="section-body-text"><b>Dependencies</b></div><div class="section-body-text">The container is meant to be using a NFS or similar network file system to persist database backups.</div><div class="section-body-text"><b>Environment Variables</b></div><ul class="list-unordered"><li class="list-unordered">BACKUP_LABEL - when set, will set the label of the backup, if not set the default label used is <b>crunchy-backup</b></li><li class="list-unordered">BACKUP_HOST - required, this is the database we will be doing the backup for</li><li class="list-unordered">BACKUP_USER - required, this is the database user we will be doing the backup with</li><li class="list-unordered">BACKUP_PASS - required, this is the database password we will be doing the backup with</li><li class="list-unordered">BACKUP_PORT - required, this is the database port we will be doing the backup with</li></ul></div></div><div class="section2"><a id="_crunchy_postgres_gis/_crunchy_pgadmin4"></a><div class="section2-header"><div class="section2-number">4.2</div><div class="section2-title">crunchy-pgadmin4</div></div><div class="section-body"><div class="section-body-text">The crunchy-ppgadmin4 container executes the pgadmin4 web application.</div><div class="section-body-text">The pgadmin4 project is found at the following location: <a href="https://www.pgadmin.org/">https://www.pgadmin.org/</a></div><div class="section-body-text">pgadmin4 provides a web user interface to PostgreSQL databases. A sample screenshot is below:</div><pre class="code-block">|</pre><div class="section-body-text"><b>Environment Variables</b></div><ul class="list-unordered"><li class="list-unordered">None</li></ul><div class="section-body-text"><b>Features</b></div><div class="section-body-text">The following features are supported by the crunchy-pgadmin4 container:</div><ul class="list-unordered"><li class="list-unordered">mount config_local.py and pgadmin4.db to /data volume inside the container to support customization and store the pgadmin4 database file</li><li class="list-unordered">expose port 5050 which is the web server port</li><li class="list-unordered">a sample pgadmin4 database is provided with an initial administrator user <b>admin@admin.org</b> and password of <b>password</b></li></ul><div class="section-body-text"><b>Restrictions</b></div><ul class="list-unordered"><li class="list-unordered">None</li></ul></div></div></div></div><div class="section1"><a id="_openshift_dedicated_template_examples"></a><div class="section1-header"><div class="section1-number">5</div><div class="section1-title">OpenShift Dedicated Template Examples</div></div><div class="section-body"><div class="section2"><a id="_openshift_dedicated_template_examples/_primary_database_template"></a><div class="section2-header"><div class="section2-number">5.1</div><div class="section2-title">Primary Database Template</div></div><div class="section-body"><div class="section-body-text">Template Name is <b>crunchy-primary</b></div><div class="section-body-text">Example is found here:</div><pre class="code-block">examples/dedicated/crunchy-primary</pre><div class="section-body-text">This template will create the following:</div><ul class="list-unordered"><li class="list-unordered">A database container crunchy-postgres as the primary running within a Deployment</li><li class="list-unordered">A database service for the primary</li></ul><div class="section-body-text">This example deploys a primary database configuration which uses a Persistent Volume Claim for persistence.</div><table class="table"><caption class="table-title">Table 1. Table Template Parameters</caption><tr class="table-header-row"><th class="table-header-left">Parameter</th><th class="table-header-left">Description</th><th class="table-header-left">Default</th></tr><tr class="table-row"><td class="table-data-left">NAME</td><td class="table-data-left">the database service name</td><td class="table-data-left">example</td></tr><tr class="table-row"><td class="table-data-left">PGDATA_PATH_OVERRIDE</td><td class="table-data-left">should match the name of the NAME parameter in most cases</td><td class="table-data-left">example</td></tr><tr class="table-row"><td class="table-data-left">PG_PRIMARY_PORT</td><td class="table-data-left">the postgres port to use</td><td class="table-data-left">5432</td></tr><tr class="table-row"><td class="table-data-left">PG_PRIMARY_USER</td><td class="table-data-left">the user name to create and use for a primary user</td><td class="table-data-left">primaryuser</td></tr><tr class="table-row"><td class="table-data-left">PG_PRIMARY_PASSWORD</td><td class="table-data-left">the password to use for the primary user</td><td class="table-data-left">password</td></tr><tr class="table-row"><td class="table-data-left">PG_USER</td><td class="table-data-left">the user name to create as a normal user</td><td class="table-data-left">testuser</td></tr><tr class="table-row"><td class="table-data-left">PG_PASSWORD</td><td class="table-data-left">the password to use for the normal user</td><td class="table-data-left">password</td></tr><tr class="table-row"><td class="table-data-left">PG_DATABASE</td><td class="table-data-left">the name of the the normal user database which will be created</td><td class="table-data-left">userdb</td></tr><tr class="table-row"><td class="table-data-left">PG_ROOT_PASSWORD</td><td class="table-data-left">the password of the postgres user</td><td class="table-data-left">password</td></tr><tr class="table-row"><td class="table-data-left">SYNC_REPLICA</td><td class="table-data-left">the name of a sync replica that will be allowed to connect if any</td></tr><tr class="table-row"><td class="table-data-left">CCP_IMAGE_TAG</td><td class="table-data-left">the image version to use for the container</td><td class="table-data-left">rhel7-9.6.8-1.8.1</td></tr><tr class="table-row"><td class="table-data-left">CCP_IMAGE_PREFIX</td><td class="table-data-left">the image prefix to use, typically the image stream prefix of your registry</td><td class="table-data-left">172.30.149.135:5000/default</td></tr><tr class="table-row"><td class="table-data-left">CCP_IMAGE_NAME</td><td class="table-data-left">the image name to use, either crunchy-postgres or crunchy-postgres-gis</td><td class="table-data-left">crunchy-postgres</td></tr><tr class="table-row"><td class="table-data-left">PVC_NAME</td><td class="table-data-left">the name to assign to the PVC created for this database typically NAME-pvc</td><td class="table-data-left">example-pvc</td></tr><tr class="table-row"><td class="table-data-left">PVC_SIZE</td><td class="table-data-left">the size of the PVC to create</td><td class="table-data-left">300M</td></tr><tr class="table-row"><td class="table-data-left">PVC_ACCESS_MODE</td><td class="table-data-left">the PVC access mode to use for the created PVC</td><td class="table-data-left">ReadWriteMany</td></tr><tr class="table-row"><td class="table-data-left">TEMP_BUFFERS</td><td class="table-data-left">the postgres temp_buffers configuration setting</td><td class="table-data-left">9MB</td></tr><tr class="table-row"><td class="table-data-left">MAX_CONNECTIONS</td><td class="table-data-left">the postgres max_connections setting</td><td class="table-data-left">101</td></tr><tr class="table-row"><td class="table-data-left">SHARED_BUFFERS</td><td class="table-data-left">the postgres shared_buffers configuration setting</td><td class="table-data-left">129MB</td></tr><tr class="table-row"><td class="table-data-left">MAX_WAL_SENDERS</td><td class="table-data-left">the postgres max_wal_senders configuration setting</td><td class="table-data-left">7</td></tr><tr class="table-row"><td class="table-data-left">WORK_MEM</td><td class="table-data-left">the postgres work-mem configuration setting</td><td class="table-data-left">5MB</td></tr></table></div></div><div class="section2"><a id="_openshift_dedicated_template_examples/_database_backup_template"></a><div class="section2-header"><div class="section2-number">5.2</div><div class="section2-title">Database Backup Template</div></div><div class="section-body"><div class="section-body-text">Template Name is <b>crunchy-backup</b></div><div class="section-body-text">Example is found here:</div><pre class="code-block">examples/dedicated/crunchy-backup</pre><div class="section-body-text">This template will create the following:</div><ul class="list-unordered"><li class="list-unordered">Job which generates a backup container</li></ul><div class="section-body-text">This example deploys a Job which results in a Pod created which will run the <b>crunchy-backup</b> container. It will create a backup of a database and store the backup files in a PVC.</div><table class="table"><caption class="table-title">Table 2. Table Template Parameters</caption><tr class="table-header-row"><th class="table-header-left">Parameter</th><th class="table-header-left">Description</th><th class="table-header-left">Default</th></tr><tr class="table-row"><td class="table-data-left">JOB_NAME</td><td class="table-data-left">the job name</td><td class="table-data-left">backupjob</td></tr><tr class="table-row"><td class="table-data-left">DB_NAME</td><td class="table-data-left">the service name of the database to backup</td><td class="table-data-left">primary</td></tr><tr class="table-row"><td class="table-data-left">PVC_NAME</td><td class="table-data-left">the PVC name to use to store the backup files</td><td class="table-data-left">backup-pvc</td></tr><tr class="table-row"><td class="table-data-left">PVC_SIZE</td><td class="table-data-left">the PVC size to allocate</td><td class="table-data-left">500M</td></tr><tr class="table-row"><td class="table-data-left">PVC_ACCESS_MODE</td><td class="table-data-left">the PVC access mode to use in the creation of the PVC</td><td class="table-data-left">ReadWriteMany</td></tr><tr class="table-row"><td class="table-data-left">BACKUP_USER</td><td class="table-data-left">the postgres user to use when performing the backup</td><td class="table-data-left">primary</td></tr><tr class="table-row"><td class="table-data-left">BACKUP_PASS</td><td class="table-data-left">the postgres user password to use when performing the backup</td><td class="table-data-left">primary</td></tr><tr class="table-row"><td class="table-data-left">CCP_IMAGE_PREFIX</td><td class="table-data-left">the container image prefix to use, typically the registry IP address and namespace</td><td class="table-data-left">172.30.149.135:5000/default</td></tr><tr class="table-row"><td class="table-data-left">CCP_IMAGE_TAG</td><td class="table-data-left">the container image version to use</td><td class="table-data-left">rhel7-9.6.8-1.8.1</td></tr></table></div></div><div class="section2"><a id="_openshift_dedicated_template_examples/_restore_database_template"></a><div class="section2-header"><div class="section2-number">5.3</div><div class="section2-title">Restore Database Template</div></div><div class="section-body"><div class="section-body-text">Template Name is <b>crunchy-restore</b></div><div class="section-body-text">Example is found here:</div><pre class="code-block">examples/dedicated/crunchy-restore</pre><div class="section-body-text">This template will create the following:</div><ul class="list-unordered"><li class="list-unordered">A database container named crunchy-postgres</li><li class="list-unordered">A database service</li></ul><div class="section-body-text">This example performs a database restore using a backup archive found in a PVC.</div><table class="table"><caption class="table-title">Table 3. Table Template Parameters</caption><tr class="table-header-row"><th class="table-header-left">Parameter</th><th class="table-header-left">Description</th><th class="table-header-left">Default</th></tr><tr class="table-row"><td class="table-data-left">NAME</td><td class="table-data-left">the job name</td><td class="table-data-left">restoredb</td></tr><tr class="table-row"><td class="table-data-left">PG_PRIMARY_PORT</td><td class="table-data-left">the postgres port to use</td><td class="table-data-left">5432</td></tr><tr class="table-row"><td class="table-data-left">PG_PRIMARY_USER</td><td class="table-data-left">the user name to create and use for a primary user</td><td class="table-data-left">primaryuser</td></tr><tr class="table-row"><td class="table-data-left">PG_PRIMARY_PASSWORD</td><td class="table-data-left">the password to use for the primary user</td><td class="table-data-left">password</td></tr><tr class="table-row"><td class="table-data-left">PG_USER</td><td class="table-data-left">the user name to create as a normal user</td><td class="table-data-left">testuser</td></tr><tr class="table-row"><td class="table-data-left">PG_PASSWORD</td><td class="table-data-left">the password to use for the normal user</td><td class="table-data-left">password</td></tr><tr class="table-row"><td class="table-data-left">PG_DATABASE</td><td class="table-data-left">the name of the the normal user database which will be created</td><td class="table-data-left">userdb</td></tr><tr class="table-row"><td class="table-data-left">PG_ROOT_PASSWORD</td><td class="table-data-left">the password of the postgres user</td><td class="table-data-left">password</td></tr><tr class="table-row"><td class="table-data-left">PGDATA_PATH_OVERRIDE</td><td class="table-data-left">the name to overide the pgdata path with typically the NAME value</td><td class="table-data-left">restoredb</td></tr><tr class="table-row"><td class="table-data-left">PVC_NAME</td><td class="table-data-left">the PVC name to use when creating the new PVC typically NAME-pvc</td><td class="table-data-left">restoredb-pvc</td></tr><tr class="table-row"><td class="table-data-left">PVC_SIZE</td><td class="table-data-left">the PVC size to allocate</td><td class="table-data-left">500M</td></tr><tr class="table-row"><td class="table-data-left">PVC_ACCESS_MODE</td><td class="table-data-left">the PVC access mode to use in the creation of the PVC</td><td class="table-data-left">ReadWriteMany</td></tr><tr class="table-row"><td class="table-data-left">BACKUP_PATH</td><td class="table-data-left">the backup archive path to restore from</td><td class="table-data-left">primary7-backups/2017-04-04-09-42-53</td></tr><tr class="table-row"><td class="table-data-left">BACKUP_PVC</td><td class="table-data-left">the backup archive PVC to restore from</td><td class="table-data-left">backup-pvc</td></tr><tr class="table-row"><td class="table-data-left">CCP_IMAGE_PREFIX</td><td class="table-data-left">the container image prefix to use, typically the registy IP address and namespace</td><td class="table-data-left">172.30.149.135:5000/default</td></tr><tr class="table-row"><td class="table-data-left">CCP_IMAGE_NAME</td><td class="table-data-left">the container image name to use, must match the image name used in the original db</td><td class="table-data-left">crunchy-postgres</td></tr><tr class="table-row"><td class="table-data-left">CCP_IMAGE_TAG</td><td class="table-data-left">the container image version to use</td><td class="table-data-left">rhel7-9.6.8-1.8.1</td></tr></table></div></div><div class="section2"><a id="_openshift_dedicated_template_examples/_replica_database_template"></a><div class="section2-header"><div class="section2-number">5.4</div><div class="section2-title">Replica Database Template</div></div><div class="section-body"><div class="section-body-text">Template names is <b>crunchy-replica</b></div><div class="section-body-text">Example is found here:</div><pre class="code-block">examples/dedicated/crunchy-replica</pre><div class="section-body-text">These templates create the following:</div><ul class="list-unordered"><li class="list-unordered">replica database container crunchy-postgres using Persistent Volume Claim</li><li class="list-unordered">service for replica</li></ul><table class="table"><caption class="table-title">Table 4. Table Template Parameters</caption><tr class="table-header-row"><th class="table-header-left">Parameter</th><th class="table-header-left">Description</th><th class="table-header-left">Default</th></tr><tr class="table-row"><td class="table-data-left">SERVICE_NAME</td><td class="table-data-left">the name to use for the database service</td><td class="table-data-left">replica</td></tr><tr class="table-row"><td class="table-data-left">PG_PRIMARY_HOST</td><td class="table-data-left">the postgres primary service name the replica will connect to</td><td class="table-data-left">primary</td></tr><tr class="table-row"><td class="table-data-left">PG_PRIMARY_PORT</td><td class="table-data-left">the postgres port to use</td><td class="table-data-left">5432</td></tr><tr class="table-row"><td class="table-data-left">PG_PRIMARY_USER</td><td class="table-data-left">the user name to create and use for a primary user</td><td class="table-data-left">primaryuser</td></tr><tr class="table-row"><td class="table-data-left">PG_PRIMARY_PASSWORD</td><td class="table-data-left">the password to use for the primary user</td><td class="table-data-left">password</td></tr><tr class="table-row"><td class="table-data-left">PVC_NAME</td><td class="table-data-left">the PVC name to use when creating the new PVC typically NAME-pvc</td><td class="table-data-left">restoredb-pvc</td></tr><tr class="table-row"><td class="table-data-left">PVC_SIZE</td><td class="table-data-left">the PVC size to allocate</td><td class="table-data-left">500M</td></tr><tr class="table-row"><td class="table-data-left">PVC_ACCESS_MODE</td><td class="table-data-left">the PVC access mode to use in the creation of the PVC</td><td class="table-data-left">ReadWriteMany</td></tr><tr class="table-row"><td class="table-data-left">CCP_IMAGE_PREFIX</td><td class="table-data-left">the container image prefix to use, typically the registy IP address and namespace</td><td class="table-data-left">172.30.149.135:5000/default</td></tr><tr class="table-row"><td class="table-data-left">CCP_IMAGE_NAME</td><td class="table-data-left">the container image name to use, must match the image name used in the original db</td><td class="table-data-left">crunchy-postgres</td></tr><tr class="table-row"><td class="table-data-left">CCP_IMAGE_TAG</td><td class="table-data-left">the container image version to use</td><td class="table-data-left">rhel7-9.6.8-1.8.1</td></tr></table></div></div><div class="section2"><a id="_openshift_dedicated_template_examples/_pgadmin4_web_user_interface_template"></a><div class="section2-header"><div class="section2-number">5.5</div><div class="section2-title">pgadmin4 Web User Interface Template</div></div><div class="section-body"><div class="section-body-text">Template Name is <b>crunchy-pgadmin4</b></div><div class="section-body-text">Example is found here:</div><pre class="code-block">examples/dedicated/crunchy-pgadmin4</pre><div class="section-body-text">This template will create the following:</div><ul class="list-unordered"><li class="list-unordered">PVC for the pgadmin4 configuration files and database</li><li class="list-unordered">pod containing the crunchy-pgadmin4 container</li><li class="list-unordered">service for the pgadmin4 container</li></ul><table class="table"><caption class="table-title">Table 5. Table Template Parameters</caption><tr class="table-header-row"><th class="table-header-left">Parameter</th><th class="table-header-left">Description</th><th class="table-header-left">Default</th></tr><tr class="table-row"><td class="table-data-left">NAME</td><td class="table-data-left">the name to use for the pgadmin4 service</td><td class="table-data-left">pgadmin4</td></tr><tr class="table-row"><td class="table-data-left">PVC_NAME</td><td class="table-data-left">the name to assign to the PVC created for this pgadmin4 typically NAME-pvc</td><td class="table-data-left">pgadmin4-pvc</td></tr><tr class="table-row"><td class="table-data-left">PVC_SIZE</td><td class="table-data-left">the size of the PVC to create</td><td class="table-data-left">300M</td></tr><tr class="table-row"><td class="table-data-left">PVC_ACCESS_MODE</td><td class="table-data-left">the PVC access mode to use for the created PVC</td><td class="table-data-left">ReadWriteMany</td></tr><tr class="table-row"><td class="table-data-left">CCP_IMAGE_PREFIX</td><td class="table-data-left">the container image prefix to use, typically the registy IP address and namespace</td><td class="table-data-left">172.30.149.135:5000/default</td></tr><tr class="table-row"><td class="table-data-left">CCP_IMAGE_TAG</td><td class="table-data-left">the container image version to use</td><td class="table-data-left">rhel7-9.6.8-1.8.1</td></tr></table></div></div></div></div><div class="section1"><a id="_legal_notices"></a><div class="section1-header"><div class="section1-number">6</div><div class="section1-title">Legal Notices</div></div><div class="section-body"><div class="section-body-text">Copyright &copy; 2018 Crunchy Data Solutions, Inc.</div><div class="section-body-text">CRUNCHY DATA SOLUTIONS, INC. PROVIDES THIS GUIDE <q>AS IS</q> WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF NON INFRINGEMENT, MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.</div><div class="section-body-text">Crunchy, Crunchy Data Solutions, Inc. and the Crunchy Hippo Logo are trademarks of Crunchy Data Solutions, Inc.</div></div></div><div class="page-footer text-center">Prepared by Crunchy Data Solutions, Inc. &mdash; March 22, 2018</div></div></div></div></body></html>